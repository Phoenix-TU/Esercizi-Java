#/bin/bash

BUILD_HOME="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/.."

source "/opt/buildhome/.sdkman/bin/sdkman-init.sh" && true
if [[ "$(type -t sdk)" != "function" ]]; then
  echo "### Installing sdkman and java 17-open"
  curl -s "https://get.sdkman.io" | bash
  source "/opt/buildhome/.sdkman/bin/sdkman-init.sh"
  sdk install java 17-open
else

if ! jupyter kernelspec list | grep -q java; then
  echo "### Installing Java kernel"
  rm -rf .install && mkdir .install && cd .install \
    && curl -#LO https://github.com/SpencerPark/IJava/releases/download/v1.3.0/ijava-1.3.0.zip \
    && unzip ijava-1.3.0.zip \
    && python install.py --sys-prefix \
    && rm -rf .install
fi

cd "$BUILD_HOME" && make html
